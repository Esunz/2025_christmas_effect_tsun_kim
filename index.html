<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#050510">
    <title>ğŸ„ 2025 Christmas Tree by Tsun Kim ğŸ„</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            overflow: hidden; 
            background-color: #050510; 
            font-family: 'Segoe UI', Arial, sans-serif; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            user-select: none;
            /* ë©”ì´í”ŒìŠ¤í† ë¦¬ ë§ˆìš°ìŠ¤ ì»¤ì„œ */
            cursor: url('c14773516089/ì¼ë°˜ ì„ íƒ.cur'), auto;
        }

        /* ë©”ì´í”ŒìŠ¤í† ë¦¬ ì»¤ì„œ - ë²„íŠ¼/ë§í¬ í˜¸ë²„ ì‹œ ì—°ê²°ì„ íƒ ì»¤ì„œ */
        a:hover, button:hover, .control-btn:hover, .blessing-nav button:hover, .close-btn:hover {
            cursor: url('c14773516089/ì—°ê²°ì„ íƒ.ani'), url('c14773516089/ì¼ë°˜ ì„ íƒ.cur'), pointer !important;
        }

        a, button, .control-btn, .blessing-nav button, .close-btn {
            cursor: url('c14773516089/ì¼ë°˜ ì„ íƒ.cur'), auto;
        }

        /* í…ìŠ¤íŠ¸ ì„ íƒ */
        input, textarea, .blessing-text {
            cursor: url('c14773516089/í…ìŠ¤íŠ¸ ì„ íƒ.cur'), text;
        }

        /* ë¡œë”©/ì‘ì—…ì¤‘ */
        .loading {
            cursor: url('c14773516089/ì‚¬ìš©ì¤‘.ani'), url('c14773516089/ì¼ë°˜ ì„ íƒ.cur'), wait;
        }

        #canvas-wrapper {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: radial-gradient(ellipse at bottom, #1a1a2e 0%, #050510 100%);
            overflow: hidden;
        }

        #canvas-container { 
            width: 100%; 
            height: 100%; 
            display: block; 
        }

        /* í—¤ë” */
        .header {
            position: absolute;
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            z-index: 100;
            pointer-events: none;
        }

        .header h1 {
            font-family: 'Playfair Display', serif;
            font-size: 2.2rem;
            font-weight: 500;
            letter-spacing: 5px;
            background: linear-gradient(135deg, #ffd700, #fff, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 40px rgba(255, 215, 0, 0.5);
            animation: titleGlow 3s ease-in-out infinite alternate;
        }

        @keyframes titleGlow {
            0% { filter: brightness(1); }
            100% { filter: brightness(1.3); }
        }

        .header .year {
            font-size: 1rem;
            color: #fff;
            letter-spacing: 0.3rem;
            margin-top: 8px;
            opacity: 0.9;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }

        /* í¬ë ˆë”§ - ë²„íŠ¼ ë°”ë¡œ ìœ„ */
        .credits {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            z-index: 100;
            pointer-events: none;
            background: rgba(0, 0, 0, 0.6);
            padding: 8px 20px;
            border-radius: 30px;
            border: 1px solid rgba(255, 215, 0, 0.3);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            max-width: 85vw;
        }

        .credits .creator {
            font-family: 'Playfair Display', serif;
            font-size: 1.6rem;
            font-style: italic;
            font-weight: 600;
            background: linear-gradient(135deg, #ffd700, #fff, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: creditGlow 2s ease-in-out infinite alternate;
        }

        @keyframes creditGlow {
            0% { filter: brightness(1) drop-shadow(0 0 10px rgba(255, 215, 0, 0.5)); }
            100% { filter: brightness(1.2) drop-shadow(0 0 20px rgba(255, 215, 0, 0.8)); }
        }

        .credits .name-kr {
            font-size: 0.8rem;
            color: #fff;
            letter-spacing: 0.5rem;
            margin-top: 4px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .credits .name-en {
            font-family: 'Playfair Display', serif;
            font-size: 0.65rem;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 3px;
            letter-spacing: 1.5px;
        }

        /* ì»¨íŠ¸ë¡¤ ë²„íŠ¼ - í•˜ë‹¨ì—ì„œ ë„‰ë„‰í•˜ê²Œ ì˜¬ë¦¼ */
        .controls {
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: center;
            gap: 5px;
            z-index: 100;
            width: 92vw;
            max-width: 400px;
            padding: 0;
            box-sizing: border-box;
        }

        .controls-row {
            display: contents;
        }

        .control-btn {
            padding: 6px 8px;
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 15px;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            color: #ffd700;
            font-size: 0.55rem;
            cursor: pointer;
            transition: all 0.2s ease;
            letter-spacing: 0;
            white-space: nowrap;
            flex: 0 0 auto;
            touch-action: manipulation;
        }

        .control-btn:hover {
            background: rgba(255, 215, 0, 0.2);
            border-color: #ffd700;
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }

        .control-btn:active {
            transform: scale(0.95);
            background: rgba(255, 215, 0, 0.3);
        }

        /* ë•ë‹´ íŒ¨ë„ - í™”ë©´ ì •ì¤‘ì•™ */
        .blessings-panel {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 600px;
            width: 90%;
            padding: 30px;
            background: rgba(0, 0, 0, 0.85);
            border: 1px solid rgba(255, 215, 0, 0.4);
            border-radius: 20px;
            backdrop-filter: blur(20px);
            z-index: 200;
            display: none;
            text-align: center;
            box-shadow: 0 0 60px rgba(255, 215, 0, 0.2);
        }

        .blessings-panel.show {
            display: block;
            animation: fadeInCenter 0.4s ease-out;
        }

        @keyframes fadeInCenter {
            from { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }

        .blessings-panel h2 {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            color: #ffd700;
            margin-bottom: 20px;
        }

        .blessing-text {
            color: #fff;
            font-size: 1.1rem;
            line-height: 1.8;
            margin-bottom: 20px;
        }

        .blessing-nav {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .blessing-nav button {
            padding: 10px 25px;
            border: 1px solid #ffd700;
            background: transparent;
            color: #ffd700;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .blessing-nav button:hover {
            background: #ffd700;
            color: #000;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 30px;
            height: 30px;
            border: none;
            background: transparent;
            color: #fff;
            font-size: 1.5rem;
            cursor: pointer;
            opacity: 0.7;
        }

        .close-btn:hover { opacity: 1; }


        /* ëˆˆ íš¨ê³¼ */
        .snowflakes {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 50;
        }

        .snowflake {
            position: absolute;
            color: white;
            font-size: 1rem;
            animation: fall linear infinite;
            text-shadow: 0 0 5px rgba(255,255,255,0.8);
        }

        @keyframes fall {
            0% { transform: translateY(-10vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(110vh) rotate(720deg); opacity: 0.3; }
        }

        /* ë¡œë”© */
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ffd700;
            font-size: 1.2rem;
            letter-spacing: 4px;
            z-index: 200;
            text-align: center;
        }

        .loading-bar {
            width: 200px;
            height: 3px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            margin-top: 20px;
            overflow: hidden;
        }

        .loading-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffd700, #fff, #ffd700);
            animation: loadingAnim 1.5s ease-in-out infinite;
        }

        @keyframes loadingAnim {
            0% { width: 0%; margin-left: 0; }
            50% { width: 100%; margin-left: 0; }
            100% { width: 0%; margin-left: 100%; }
        }

        /* ë¶ˆê½ƒë†€ì´ */
        .firework-particle {
            position: fixed;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 999;
            animation: fireworkExplode 1.5s ease-out forwards;
        }

        @keyframes fireworkExplode {
            0% { transform: translate(0, 0) scale(1); opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; }
        }

        /* ë§ˆìš°ìŠ¤ íŠ¸ë ˆì¼ */
        .mouse-trail {
            position: fixed;
            pointer-events: none;
            font-size: 1rem;
            animation: trailFade 1s ease-out forwards;
            z-index: 1000;
        }

        @keyframes trailFade {
            0% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(0.5) translateY(-20px); }
        }

        /* =============================================
           ë°˜ì‘í˜• ë””ìì¸ - ìŠ¤ë§ˆíŠ¸í° í•´ìƒë„ë³„ ìµœì í™”
           ============================================= */


        /* ì¤Œ ì»¨íŠ¸ë¡¤ (ëª¨ë°”ì¼ìš©) - í•­ìƒ í‘œì‹œ */
        .zoom-controls {
            display: none;
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            flex-direction: column;
            gap: 8px;
            z-index: 150;
        }

        .zoom-btn {
            width: 46px;
            height: 46px;
            border-radius: 50%;
            border: 1px solid rgba(255, 215, 0, 0.5);
            background: rgba(0, 0, 0, 0.7);
            color: #ffd700;
            font-size: 1.4rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            touch-action: manipulation;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }

        .zoom-btn:active {
            background: rgba(255, 215, 0, 0.4);
            transform: scale(0.9);
        }

        /* ëª¨ë°”ì¼ì—ì„œ ì¤Œ ë²„íŠ¼ í‘œì‹œ */
        @media (max-width: 1024px), (hover: none) and (pointer: coarse) {
            .zoom-controls {
                display: flex;
            }
        }

        /* ===== íƒœë¸”ë¦¿ (768px ~ 1024px) ===== */
        @media (max-width: 1024px) {
            .header h1 { font-size: 1.8rem; letter-spacing: 4px; }
            .header .year { font-size: 0.85rem; }
            .credits .creator { font-size: 1.4rem; }
            .credits .name-kr { font-size: 0.7rem; letter-spacing: 0.3rem; }
            .control-btn { padding: 7px 10px; font-size: 0.6rem; }
        }

        /* ===== ëª¨ë°”ì¼ ëŒ€í˜• (430px ~ 768px) - iPhone Pro Max, Galaxy S Ultra ===== */
        @media (max-width: 768px) {
            .header { top: 25px; }
            .header h1 { font-size: 1.4rem; letter-spacing: 3px; }
            .header .year { font-size: 0.65rem; letter-spacing: 0.15rem; }
            
            .credits { 
                bottom: 95px; 
                padding: 6px 14px;
            }
            .credits .creator { font-size: 1.1rem; }
            .credits .name-kr { font-size: 0.6rem; letter-spacing: 0.2rem; }
            .credits .name-en { font-size: 0.5rem; }

            .controls {
                bottom: 45px;
                gap: 4px;
                width: 95vw;
                max-width: 360px;
            }
            .control-btn { 
                padding: 6px 8px; 
                font-size: 0.52rem; 
                border-radius: 12px;
            }

            .zoom-controls { display: flex; right: 8px; }
            .zoom-btn { width: 36px; height: 36px; font-size: 1rem; }

            .blessings-panel {
                width: 95%;
                padding: 20px 15px;
            }
            .blessings-panel h2 { font-size: 1.1rem; }
            .blessing-text { font-size: 0.85rem; line-height: 1.6; }
            .blessing-nav button { padding: 8px 16px; font-size: 0.75rem; }
        }

        /* ===== ì¼ë°˜ ìŠ¤ë§ˆíŠ¸í° (393px ~ 430px) - iPhone 14/15/16 Pro, Galaxy S24 ===== */
        @media (max-width: 430px) {
            .header { top: 20px; }
            .header h1 { font-size: 1.25rem; letter-spacing: 2px; }
            .header .year { font-size: 0.6rem; letter-spacing: 0.1rem; margin-top: 4px; }

            .credits { 
                bottom: 90px; 
                padding: 5px 12px;
                max-width: 80%;
            }
            .credits .creator { font-size: 0.95rem; }
            .credits .name-kr { 
                font-size: 0.55rem; 
                letter-spacing: 0.15rem; 
                margin-top: 2px;
            }
            .credits .name-en { font-size: 0.48rem; margin-top: 1px; }

            .controls {
                bottom: 40px;
                gap: 3px;
                width: 92vw;
                max-width: 340px;
            }
            .control-btn { 
                padding: 5px 6px; 
                font-size: 0.48rem;
                border-radius: 10px;
            }

            .zoom-controls { right: 6px; gap: 5px; }
            .zoom-btn { width: 34px; height: 34px; font-size: 0.95rem; }

            .blessings-panel {
                padding: 16px 12px;
                border-radius: 12px;
                max-height: 70vh;
                overflow-y: auto;
            }
            .blessings-panel h2 { font-size: 0.95rem; margin-bottom: 10px; }
            .blessing-text { font-size: 0.78rem; line-height: 1.5; margin-bottom: 10px; }
            .blessing-nav { gap: 6px; }
            .blessing-nav button { padding: 7px 12px; font-size: 0.7rem; }
            .close-btn { top: 8px; right: 8px; font-size: 1.1rem; }
        }

        /* ===== ì¤‘í˜• ìŠ¤ë§ˆíŠ¸í° (375px ~ 393px) - iPhone 12/13/14, Galaxy S21/22/23 ===== */
        @media (max-width: 393px) {
            .header { top: 18px; }
            .header h1 { font-size: 1.15rem; letter-spacing: 1.5px; }
            .header .year { font-size: 0.55rem; letter-spacing: 0.08rem; }

            .credits { 
                bottom: 85px; 
                padding: 4px 10px;
            }
            .credits .creator { font-size: 0.88rem; }
            .credits .name-kr { font-size: 0.5rem; letter-spacing: 0.12rem; }
            .credits .name-en { font-size: 0.45rem; }

            .controls { 
                bottom: 38px;
                gap: 3px; 
                width: 90vw;
                max-width: 320px;
            }
            .control-btn { 
                padding: 4px 5px; 
                font-size: 0.45rem;
                border-radius: 9px;
            }

            .zoom-btn { width: 32px; height: 32px; font-size: 0.9rem; }
        }

        /* ===== ì†Œí˜• ìŠ¤ë§ˆíŠ¸í° (360px ~ 375px) - Galaxy S20/21/22/23 í‘œì¤€ ===== */
        @media (max-width: 375px) {
            .header { top: 15px; }
            .header h1 { font-size: 1.08rem; letter-spacing: 1px; }
            .header .year { font-size: 0.52rem; letter-spacing: 0.05rem; }

            .credits { 
                bottom: 80px; 
                padding: 4px 8px;
            }
            .credits .creator { font-size: 0.82rem; }
            .credits .name-kr { font-size: 0.48rem; letter-spacing: 0.1rem; }
            .credits .name-en { display: none; }

            .controls { 
                gap: 2px; 
                bottom: 35px;
                width: 88vw;
                max-width: 300px;
            }
            .control-btn { 
                padding: 4px 4px; 
                font-size: 0.42rem;
                border-radius: 8px;
            }

            .zoom-btn { width: 30px; height: 30px; font-size: 0.85rem; }

            .blessings-panel h2 { font-size: 0.88rem; }
            .blessing-text { font-size: 0.72rem; }
        }

        /* ===== ë§¤ìš° ì‘ì€ ìŠ¤ë§ˆíŠ¸í° (320px ~ 360px) - iPhone SE, Galaxy A ===== */
        @media (max-width: 360px) {
            .header { top: 12px; }
            .header h1 { font-size: 1rem; letter-spacing: 0.5px; }
            .header .year { font-size: 0.48rem; }

            .credits { 
                bottom: 75px; 
                padding: 3px 6px;
            }
            .credits .creator { font-size: 0.75rem; }
            .credits .name-kr { font-size: 0.45rem; letter-spacing: 0.08rem; }

            .controls { 
                gap: 2px; 
                bottom: 32px;
                width: 86vw;
                max-width: 280px;
            }
            .control-btn { 
                padding: 3px 4px; 
                font-size: 0.4rem;
                border-radius: 7px;
            }

            .zoom-btn { width: 28px; height: 28px; font-size: 0.8rem; }
        }

        /* ===== ì´ˆì†Œí˜• í™”ë©´ (320px ë¯¸ë§Œ) ===== */
        @media (max-width: 320px) {
            .header h1 { font-size: 0.9rem; }
            .header .year { font-size: 0.45rem; }
            .credits { bottom: 70px; }
            .credits .creator { font-size: 0.7rem; }
            .credits .name-kr { font-size: 0.42rem; }
            .controls { bottom: 28px; width: 85vw; max-width: 260px; }
            .control-btn { padding: 3px 3px; font-size: 0.38rem; }
            .zoom-btn { width: 26px; height: 26px; font-size: 0.75rem; }
        }

        /* ===== ê°€ë¡œ ëª¨ë“œ (Landscape) ìµœì í™” ===== */
        @media (max-height: 500px) and (orientation: landscape) {
            .header { top: 8px; }
            .header h1 { font-size: 1rem; }
            .header .year { font-size: 0.5rem; margin-top: 2px; }

            .credits { 
                bottom: auto;
                top: 8px;
                right: 10px;
                left: auto;
                transform: none;
                padding: 4px 8px;
                text-align: right;
            }
            .credits .creator { font-size: 0.75rem; }
            .credits .name-kr { font-size: 0.45rem; letter-spacing: 0.1rem; }
            .credits .name-en { display: none; }

            .controls {
                bottom: 8px;
                gap: 3px;
                width: 80vw;
                max-width: 400px;
            }
            .control-btn { padding: 4px 5px; font-size: 0.42rem; }

            .zoom-controls { 
                top: 50%;
                bottom: auto;
                transform: translateY(-50%);
                right: 6px;
            }
            .zoom-btn { width: 30px; height: 30px; font-size: 0.85rem; }

            .blessings-panel {
                max-height: 85vh;
                overflow-y: auto;
                padding: 12px 10px;
            }
            .blessings-panel h2 { font-size: 0.85rem; margin-bottom: 8px; }
            .blessing-text { font-size: 0.65rem; }
        }

        /* ===== í´ë”ë¸” ê¸°ê¸° (Galaxy Z Fold) - í¼ì¹œ í™”ë©´ ===== */
        @media (min-width: 600px) and (max-width: 900px) and (min-height: 800px) {
            .header { top: 30px; }
            .header h1 { font-size: 1.6rem; letter-spacing: 4px; }
            .header .year { font-size: 0.8rem; }

            .credits { 
                bottom: 110px; 
                padding: 8px 18px;
            }
            .credits .creator { font-size: 1.2rem; }
            .credits .name-kr { font-size: 0.65rem; letter-spacing: 0.25rem; }
            .credits .name-en { font-size: 0.55rem; }

            .controls { 
                gap: 5px; 
                bottom: 50px;
                max-width: 380px;
            }
            .control-btn { 
                padding: 7px 9px; 
                font-size: 0.55rem;
            }

            .zoom-controls { display: flex; }
        }

        /* ===== í´ë”ë¸” ê¸°ê¸° ì™¸ë¶€ í™”ë©´ (ì¢ì€ ì„¸ë¡œ í™”ë©´) ===== */
        @media (max-width: 400px) and (min-height: 800px) {
            .header { top: 18px; }
            .header h1 { font-size: 1.1rem; letter-spacing: 1px; }
            .header .year { font-size: 0.52rem; }

            .credits { 
                bottom: 88px; 
                padding: 5px 10px;
            }
            .credits .creator { font-size: 0.88rem; }
            .credits .name-kr { font-size: 0.52rem; letter-spacing: 0.15rem; }
            .credits .name-en { display: none; }

            .controls { 
                gap: 3px; 
                bottom: 40px;
                max-width: 310px;
            }
            .control-btn { 
                padding: 4px 5px; 
                font-size: 0.45rem;
            }
        }

        /* ===== ë…¸ì¹˜/ë‹¤ì´ë‚˜ë¯¹ ì•„ì¼ëœë“œ ëŒ€ì‘ (iPhone X ì´ìƒ) ===== */
        @supports (padding: env(safe-area-inset-top)) {
            .header {
                top: calc(18px + env(safe-area-inset-top));
            }
            .controls {
                bottom: calc(40px + env(safe-area-inset-bottom));
            }
            .credits {
                bottom: calc(90px + env(safe-area-inset-bottom));
            }
        }

        /* ===== í„°ì¹˜ ë””ë°”ì´ìŠ¤ ìµœì í™” ===== */
        @media (hover: none) and (pointer: coarse) {
            .control-btn:hover {
                transform: none;
                box-shadow: none;
            }
            .control-btn:active {
                background: rgba(255, 215, 0, 0.3);
                transform: scale(0.95);
            }
            .blessing-nav button:hover {
                background: transparent;
                color: #ffd700;
            }
            .blessing-nav button:active {
                background: #ffd700;
                color: #000;
            }
        }

        /* ===== ë‹¤í¬ëª¨ë“œ ì‹œìŠ¤í…œ ì„¤ì • ëŒ€ì‘ ===== */
        @media (prefers-color-scheme: dark) {
            /* ì´ë¯¸ ë‹¤í¬ í…Œë§ˆì´ë¯€ë¡œ ì¶”ê°€ ì¡°ì • ì—†ìŒ */
        }

        /* ===== ê³ ëŒ€ë¹„ ëª¨ë“œ ===== */
        @media (prefers-contrast: high) {
            .control-btn {
                border-width: 2px;
            }
            .credits {
                border-width: 2px;
            }
        }

        /* ===== ì• ë‹ˆë©”ì´ì…˜ ê°ì†Œ ëª¨ë“œ ===== */
        @media (prefers-reduced-motion: reduce) {
            .snowflake,
            .mouse-trail,
            .firework-particle {
                animation: none;
            }
            .header h1,
            .credits .creator {
                animation: none;
            }
        }
    </style>
    
    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
            }
        }
    </script>
</head>
<body>
    <!-- ë°°ê²½ ìŒì•… (ê³ ìš”í•œ ë°¤ ê±°ë£©í•œ ë°¤) -->
    <audio id="bgMusic" loop preload="auto">
        <source src="music/[No Copyright Music] ê³ ìš”í•œ ë°¤ ê±°ë£©í•œ ë°¤(Silent Night Holy Night) by. ìƒìƒì‘ê³¡ê°€(ë¬´ë£Œìºë¡¤).mp3" type="audio/mpeg">
    </audio>

    <div id="canvas-wrapper">
        <div id="canvas-container"></div>

        <!-- ë¡œë”© -->
        <div class="loading" id="loading">
            <div>ğŸ„ CRAFTING MAGIC...</div>
            <div class="loading-bar">
                <div class="loading-bar-fill"></div>
            </div>
        </div>

        <!-- í—¤ë” -->
        <header class="header">
            <h1>Merry Christmas</h1>
            <div class="year">âœ¦ 2 0 2 5 âœ¦</div>
        </header>


        <!-- ì¤Œ ì»¨íŠ¸ë¡¤ (ëª¨ë°”ì¼ìš©) -->
        <div class="zoom-controls" id="zoomControls">
            <button class="zoom-btn" onclick="zoomIn()" aria-label="í™•ëŒ€">+</button>
            <button class="zoom-btn" onclick="zoomOut()" aria-label="ì¶•ì†Œ">âˆ’</button>
        </div>

        <!-- ëˆˆ íš¨ê³¼ -->
        <div class="snowflakes" id="snowflakes"></div>

        <!-- ë•ë‹´ íŒ¨ë„ -->
        <section class="blessings-panel" id="blessingsPanel">
            <button class="close-btn" onclick="closeBlessings()">Ã—</button>
            <h2>ğŸ„ 2025ë…„ ìƒˆí•´ ë•ë‹´ ğŸ„</h2>
            <div class="blessing-text" id="blessingText">
                ğŸŒŸ 2025ë…„ ìƒˆí•´ì—ëŠ” ë‹¹ì‹ ì˜ ëª¨ë“  ê¿ˆê³¼ í¬ë§ì´ ì´ë£¨ì–´ì§€ê¸¸ ë°”ëë‹ˆë‹¤.<br>
                ë§¤ì¼ ì•„ì¹¨ ëˆˆì„ ëœ° ë•Œë§ˆë‹¤ ê°ì‚¬í•¨ê³¼ í–‰ë³µì´ ê°€ë“í•˜ì‹œê¸¸!
            </div>
            <div class="blessing-nav">
                <button onclick="prevBlessing()">â—€ ì´ì „</button>
                <button onclick="nextBlessing()">ë‹¤ìŒ â–¶</button>
            </div>
        </section>

        <!-- í¬ë ˆë”§ -->
        <footer class="credits">
            <div class="creator">Tsun Kim</div>
            <div class="name-kr">ê¹€ ê²½ í•œ</div>
            <div class="name-en">KIM GYEONG HAN</div>
        </footer>

        <!-- ì»¨íŠ¸ë¡¤ - 2ì¤„ ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ -->
        <div class="controls">
            <div class="controls-row">
                <button class="control-btn" onclick="toggleTreeMode()">ğŸ„ íŠ¸ë¦¬/ì‚°ê°œ</button>
                <button class="control-btn" onclick="toggleSnow()">â„ï¸ ëˆˆ</button>
                <button class="control-btn" onclick="launchFireworks()">ğŸ† ë¶ˆê½ƒ</button>
            </div>
            <div class="controls-row">
                <button class="control-btn" onclick="toggleAutoRotate()">ğŸ”„ ìë™íšŒì „</button>
                <button class="control-btn" onclick="resetCamera()">ğŸ¯ ë¦¬ì…‹</button>
                <button class="control-btn" onclick="showBlessings()">ğŸ’ ë•ë‹´</button>
                <button class="control-btn" id="musicBtn" onclick="toggleMusic()">ğŸ”Š ìŒì•…</button>
            </div>
        </div>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';

        // ============================================
        // ğŸ„ 2025 Christmas Tree
        // Created by Tsun Kim (ê¹€ê²½í•œ)
        // ============================================

        // --- ì„¤ì • (íŠ¸ë¦¬ í¬ê¸° ì¶•ì†Œí•˜ì—¬ í•œ í™”ë©´ì— ë‹¤ ë³´ì´ê²Œ) ---
        const CONFIG = {
            goldCount: 600,      // ê¸ˆìƒ‰ êµ¬ì²´
            silverCount: 500,    // ì€ìƒ‰ íë¸Œ
            gemCount: 350,       // ë¹¨ê°„ ë³´ì„
            emeraldCount: 350,   // ì´ˆë¡ ë³´ì„
            dustCount: 1200,     // ë¨¼ì§€ íŒŒí‹°í´
            treeHeight: 55,      // íŠ¸ë¦¬ ë†’ì´ ì¶•ì†Œ (80 â†’ 55)
            maxRadius: 22,       // íŠ¸ë¦¬ ë°˜ê²½ ì¶•ì†Œ (32 â†’ 22)
            camDistance: 180,    // ì¹´ë©”ë¼ ê±°ë¦¬ - ìµœëŒ€ ì¶•ì†Œ ìƒíƒœë¡œ ì‹œì‘
            bloomStrength: 0.8,
            bloomThreshold: 0.3,
            bloomRadius: 0.7
        };

        const STATE = { TREE: 'tree', SCATTER: 'scatter' };
        let currentState = STATE.TREE;
        
        // --- Three.js ë³€ìˆ˜ ---
        let scene, camera, renderer, composer;
        let mainGroup = new THREE.Group();
        let goldMesh, silverMesh, gemMesh, emeraldMesh, dustSystem;
        
        // --- ë¡œì§ ë°ì´í„° ---
        let logicData = { gold: [], silver: [], gem: [], emerald: [], dust: [], star: null };
        const dummy = new THREE.Object3D();
        let time = 0;
        
        // --- ì¸í„°ë™ì…˜ ë³€ìˆ˜ ---
        let isDragging = false;
        let previousMousePosition = { x: 0, y: 0 };
        let autoRotate = true;
        let rotationVelocity = { x: 0, y: 0 };

        // --- ë°°ê²½ ìŒì•… ---
        const bgMusic = document.getElementById('bgMusic');
        let musicPlaying = false;
        let musicInitialized = false;

        function tryPlayMusic() {
            if (bgMusic && !musicPlaying) {
                bgMusic.volume = 0.4; // ë³¼ë¥¨ 40%
                const playPromise = bgMusic.play();
                
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        musicPlaying = true;
                        musicInitialized = true;
                        updateMusicButton();
                    }).catch((error) => {
                        // ìë™ ì¬ìƒì´ ì°¨ë‹¨ëœ ê²½ìš°, ì‚¬ìš©ì ìƒí˜¸ì‘ìš© í›„ ì¬ìƒ
                        console.log('ìë™ ì¬ìƒ ì°¨ë‹¨ë¨. í„°ì¹˜/í´ë¦­ ëŒ€ê¸° ì¤‘...');
                        setupMusicInteractionListeners();
                    });
                }
            }
        }

        function setupMusicInteractionListeners() {
            if (musicInitialized) return;
            
            const playOnInteraction = (e) => {
                if (bgMusic && !musicPlaying) {
                    bgMusic.volume = 0.4;
                    bgMusic.play().then(() => {
                        musicPlaying = true;
                        musicInitialized = true;
                        updateMusicButton();
                        // ë¦¬ìŠ¤ë„ˆ ì œê±°
                        document.removeEventListener('click', playOnInteraction);
                        document.removeEventListener('touchstart', playOnInteraction);
                        document.removeEventListener('touchend', playOnInteraction);
                        document.removeEventListener('mousedown', playOnInteraction);
                    }).catch(e => {
                        console.log('ìŒì•… ì¬ìƒ ì‹¤íŒ¨:', e);
                    });
                }
            };
            
            // ì—¬ëŸ¬ ì´ë²¤íŠ¸ì— ë¦¬ìŠ¤ë„ˆ ë“±ë¡ (ëª¨ë°”ì¼ í¬ë¡¬ ëŒ€ì‘)
            document.addEventListener('click', playOnInteraction, { passive: true });
            document.addEventListener('touchstart', playOnInteraction, { passive: true });
            document.addEventListener('touchend', playOnInteraction, { passive: true });
            document.addEventListener('mousedown', playOnInteraction, { passive: true });
        }

        function toggleMusic() {
            if (bgMusic) {
                if (musicPlaying) {
                    bgMusic.pause();
                    musicPlaying = false;
                } else {
                    bgMusic.volume = 0.4;
                    bgMusic.play().then(() => {
                        musicPlaying = true;
                        musicInitialized = true;
                    }).catch(e => console.log('ìŒì•… ì¬ìƒ ì‹¤íŒ¨:', e));
                }
                updateMusicButton();
            }
        }

        function updateMusicButton() {
            const musicBtn = document.getElementById('musicBtn');
            if (musicBtn) {
                musicBtn.innerHTML = musicPlaying ? 'ğŸ”Š ìŒì•…' : 'ğŸ”‡ ìŒì•…';
            }
        }

        // --- ì´ˆê¸°í™” ---
        function init() {
            const wrapper = document.getElementById('canvas-wrapper');
            const container = document.getElementById('canvas-container');
            
            // ì”¬
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x050510);
            scene.fog = new THREE.FogExp2(0x050510, 0.002);

            // ì¹´ë©”ë¼ (íŠ¸ë¦¬ê°€ í™”ë©´ì— ë‹¤ ë³´ì´ë„ë¡ ì¡°ì •)
            camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 5, CONFIG.camDistance);

            // ë Œë”ëŸ¬
            renderer = new THREE.WebGLRenderer({ 
                antialias: true, 
                powerPreference: "high-performance"
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            renderer.toneMappingExposure = 1.2;
            container.appendChild(renderer.domElement);

            // ì¡°ëª…
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.3);
            scene.add(ambientLight);

            const spotLight = new THREE.SpotLight(0xffddaa, 150);
            spotLight.position.set(30, 100, 50);
            spotLight.angle = Math.PI / 4;
            spotLight.penumbra = 1;
            scene.add(spotLight);

            const blueLight = new THREE.PointLight(0x4488ff, 80, 250);
            blueLight.position.set(-50, -30, 50);
            scene.add(blueLight);

            const redLight = new THREE.PointLight(0xff4444, 50, 200);
            redLight.position.set(50, 20, -50);
            scene.add(redLight);
            
            // í›„ì²˜ë¦¬ (Bloom)
            const renderScene = new RenderPass(scene, camera);
            const bloomPass = new UnrealBloomPass(
                new THREE.Vector2(window.innerWidth, window.innerHeight),
                CONFIG.bloomStrength,
                CONFIG.bloomRadius,
                CONFIG.bloomThreshold
            );

            composer = new EffectComposer(renderer);
            composer.addPass(renderScene);
            composer.addPass(bloomPass);

            // ì˜¤ë¸Œì íŠ¸ ìƒì„±
            createMaterialsAndMeshes();
            createDust();
            createStarField();
            createTopStar();

            scene.add(mainGroup);

            // ì´ë²¤íŠ¸
            addEventListeners();

            // ë¡œë”© ì™„ë£Œ
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
                
                // ë°°ê²½ ìŒì•… ìë™ ì¬ìƒ ì‹œë„
                tryPlayMusic();
            }, 1500);

            // ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
            animate();
        }

        // --- ì¬ì§ˆê³¼ ë©”ì‹œ ìƒì„± ---
        function createMaterialsAndMeshes() {
            // ê¸ˆìƒ‰ êµ¬ì²´
            const goldMat = new THREE.MeshPhysicalMaterial({
                color: 0xffaa00,
                metalness: 1.0,
                roughness: 0.15,
                clearcoat: 1.0,
                emissive: 0xaa5500,
                emissiveIntensity: 0.15
            });
            
            // ì€ìƒ‰ íë¸Œ
            const silverMat = new THREE.MeshPhysicalMaterial({
                color: 0xffffff,
                metalness: 0.95,
                roughness: 0.1,
                clearcoat: 1.0,
                emissive: 0x333333,
                emissiveIntensity: 0.1
            });
            
            // ë¹¨ê°„ ë³´ì„ (ë£¨ë¹„)
            const gemMat = new THREE.MeshPhysicalMaterial({
                color: 0xff0044,
                metalness: 0.1,
                roughness: 0.0,
                transmission: 0.6,
                thickness: 1.5,
                emissive: 0x550011,
                emissiveIntensity: 0.5
            });
            
            // ì´ˆë¡ ë³´ì„ (ì—ë©”ë„ë“œ)
            const emeraldMat = new THREE.MeshPhysicalMaterial({
                color: 0x00aa55,
                metalness: 0.2,
                roughness: 0.1,
                transmission: 0.5,
                thickness: 1.5,
                emissive: 0x002211,
                emissiveIntensity: 0.4
            });

            goldMesh = createInstancedMesh(
                new THREE.SphereGeometry(0.7, 16, 16), 
                goldMat, 
                CONFIG.goldCount, 
                logicData.gold
            );
            
            silverMesh = createInstancedMesh(
                new THREE.BoxGeometry(0.8, 0.8, 0.8), 
                silverMat, 
                CONFIG.silverCount, 
                logicData.silver
            );
            
            gemMesh = createInstancedMesh(
                new THREE.OctahedronGeometry(0.9, 0), 
                gemMat, 
                CONFIG.gemCount, 
                logicData.gem
            );
            
            emeraldMesh = createInstancedMesh(
                new THREE.TetrahedronGeometry(0.8, 0), 
                emeraldMat, 
                CONFIG.emeraldCount, 
                logicData.emerald
            );
        }

        function createInstancedMesh(geo, mat, count, dataArray) {
            const mesh = new THREE.InstancedMesh(geo, mat, count);
            mesh.instanceMatrix.setUsage(THREE.DynamicDrawUsage);
            mainGroup.add(mesh);
            
            for (let i = 0; i < count; i++) {
                const h = Math.random() * CONFIG.treeHeight - CONFIG.treeHeight / 2;
                const normH = (h + CONFIG.treeHeight / 2) / CONFIG.treeHeight;
                const rMax = CONFIG.maxRadius * (1 - normH) * 1.1;
                
                const r = Math.sqrt(Math.random()) * rMax;
                const theta = Math.random() * Math.PI * 2;
                
                const treePos = new THREE.Vector3(
                    r * Math.cos(theta), 
                    h, 
                    r * Math.sin(theta)
                );
                const scatterPos = randomSpherePoint(35 + Math.random() * 40);

                dataArray.push({
                    treePos: treePos,
                    scatterPos: scatterPos,
                    currentPos: treePos.clone(),
                    scale: 0.5 + Math.random() * 0.9,
                    rotSpeed: new THREE.Euler(
                        Math.random() * 0.03, 
                        Math.random() * 0.03, 
                        0
                    ),
                    rotation: new THREE.Euler(
                        Math.random() * Math.PI, 
                        Math.random() * Math.PI, 
                        0
                    )
                });
            }
            return mesh;
        }

        function randomSpherePoint(r) {
            const u = Math.random(), v = Math.random();
            const theta = 2 * Math.PI * u;
            const phi = Math.acos(2 * v - 1);
            return new THREE.Vector3(
                r * Math.sin(phi) * Math.cos(theta),
                r * Math.sin(phi) * Math.sin(theta),
                r * Math.cos(phi)
            );
        }

        // --- ë¨¼ì§€ íŒŒí‹°í´ ---
        function createDust() {
            const geo = new THREE.BufferGeometry();
            const pos = new Float32Array(CONFIG.dustCount * 3);
            const colors = new Float32Array(CONFIG.dustCount * 3);
            
            for (let i = 0; i < CONFIG.dustCount; i++) {
                const h = Math.random() * CONFIG.treeHeight - CONFIG.treeHeight / 2;
                const r = Math.random() * CONFIG.maxRadius + 5;
                const theta = Math.random() * Math.PI * 2;
                
                const x = r * Math.cos(theta);
                const z = r * Math.sin(theta);
                
                pos[i * 3] = x;
                pos[i * 3 + 1] = h;
                pos[i * 3 + 2] = z;
                
                // ìƒ‰ìƒ (ê¸ˆìƒ‰ ~ í°ìƒ‰)
                const t = Math.random();
                colors[i * 3] = 1;
                colors[i * 3 + 1] = 0.7 + t * 0.3;
                colors[i * 3 + 2] = t * 0.3;
                
                logicData.dust.push({
                    treePos: new THREE.Vector3(x, h, z),
                    scatterPos: randomSpherePoint(55),
                    currentPos: new THREE.Vector3(x, h, z),
                    velocity: Math.random() * 0.05 + 0.02
                });
            }
            
            geo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
            geo.setAttribute('color', new THREE.BufferAttribute(colors, 3));
            
            const mat = new THREE.PointsMaterial({
                size: 0.6,
                transparent: true,
                opacity: 0.5,
                vertexColors: true,
                blending: THREE.AdditiveBlending,
                depthWrite: false
            });
            
            dustSystem = new THREE.Points(geo, mat);
            mainGroup.add(dustSystem);
        }

        // --- ë°°ê²½ ë³„ ---
        function createStarField() {
            const geo = new THREE.BufferGeometry();
            const pos = [];
            const colors = [];
            
            for (let i = 0; i < 1000; i++) {
                pos.push(
                    (Math.random() - 0.5) * 1000,
                    (Math.random() - 0.5) * 1000,
                    (Math.random() - 0.5) * 1000
                );
                
                const brightness = 0.3 + Math.random() * 0.7;
                colors.push(brightness, brightness, brightness);
            }
            
            geo.setAttribute('position', new THREE.Float32BufferAttribute(pos, 3));
            geo.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));
            
            const stars = new THREE.Points(geo, new THREE.PointsMaterial({
                size: 1.2,
                transparent: true,
                opacity: 0.8,
                vertexColors: true
            }));
            scene.add(stars);
        }

        // --- íŠ¸ë¦¬ ê¼­ëŒ€ê¸° ë³„ ---
        function createTopStar() {
            const starGeo = new THREE.OctahedronGeometry(3.0, 0);  // ë³„ í¬ê¸° ì¶•ì†Œ
            const starMat = new THREE.MeshPhysicalMaterial({
                color: 0xffffff,
                metalness: 0.9,
                roughness: 0,
                emissive: 0xffffaa,
                emissiveIntensity: 2.0
            });
            
            const star = new THREE.Mesh(starGeo, starMat);
            star.userData = {
                treePos: new THREE.Vector3(0, CONFIG.treeHeight / 2 + 3, 0),
                scatterPos: new THREE.Vector3(0, 50, 0)
            };
            star.position.copy(star.userData.treePos);
            
            // ë³„ ì£¼ë³€ ë¹›
            const starLight = new THREE.PointLight(0xffffaa, 80, 40);
            starLight.position.copy(star.position);
            mainGroup.add(starLight);
            
            mainGroup.add(star);
            logicData.star = star;
        }

        // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
        function addEventListeners() {
            window.addEventListener('resize', onWindowResize);
            
            renderer.domElement.addEventListener('mousedown', onMouseDown);
            renderer.domElement.addEventListener('mousemove', onMouseMove);
            renderer.domElement.addEventListener('mouseup', onMouseUp);
            renderer.domElement.addEventListener('mouseleave', onMouseUp);
            renderer.domElement.addEventListener('wheel', onMouseWheel);
            
            renderer.domElement.addEventListener('touchstart', onTouchStart, { passive: false });
            renderer.domElement.addEventListener('touchmove', onTouchMove, { passive: false });
            renderer.domElement.addEventListener('touchend', onTouchEnd, { passive: false });

            document.addEventListener('keydown', onKeyDown);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            composer.setSize(window.innerWidth, window.innerHeight);
        }

        function onMouseDown(e) {
            isDragging = true;
            previousMousePosition = { x: e.clientX, y: e.clientY };
            document.getElementById('hint').style.display = 'none';
        }

        function onMouseMove(e) {
            if (!isDragging) return;
            
            const deltaX = e.clientX - previousMousePosition.x;
            const deltaY = e.clientY - previousMousePosition.y;
            
            rotationVelocity.y += deltaX * 0.002;
            rotationVelocity.x += deltaY * 0.001;
            
            previousMousePosition = { x: e.clientX, y: e.clientY };
        }

        function onMouseUp() {
            isDragging = false;
        }

        function onMouseWheel(e) {
            camera.position.z += e.deltaY * 0.05;
            camera.position.z = Math.max(40, Math.min(180, camera.position.z));
        }

        // --- ëª¨ë°”ì¼ í„°ì¹˜ ì¸í„°ë™ì…˜ (ê°œì„ ) ---
        let touchStartDistance = 0;
        let initialCameraZ = CONFIG.camDistance;
        let lastTouchTime = 0;

        function onTouchStart(e) {
            e.preventDefault();
            
            // ëª¨ë°”ì¼ íŒíŠ¸ ìˆ¨ê¸°ê¸°
            const mobileHint = document.getElementById('mobileHint');
            if (mobileHint) mobileHint.style.display = 'none';

            if (e.touches.length === 1) {
                // í•œ ì†ê°€ë½: íšŒì „
                isDragging = true;
                previousMousePosition = { 
                    x: e.touches[0].clientX, 
                    y: e.touches[0].clientY 
                };

                // ë”ë¸”íƒ­ ê°ì§€
                const now = Date.now();
                if (now - lastTouchTime < 300) {
                    // ë”ë¸”íƒ­: íŠ¸ë¦¬/ì‚°ê°œ í† ê¸€
                    window.toggleTreeMode();
                }
                lastTouchTime = now;

            } else if (e.touches.length === 2) {
                // ë‘ ì†ê°€ë½: í•€ì¹˜ ì¤Œ
                isDragging = false;
                touchStartDistance = getTouchDistance(e.touches);
                initialCameraZ = camera.position.z;
            }
        }

        function onTouchMove(e) {
            e.preventDefault();

            if (e.touches.length === 1 && isDragging) {
                // í•œ ì†ê°€ë½: 360ë„ íšŒì „ (ì¢Œìš° + ìƒí•˜)
                const deltaX = e.touches[0].clientX - previousMousePosition.x;
                const deltaY = e.touches[0].clientY - previousMousePosition.y;
                
                // ì¢Œìš° íšŒì „ (Yì¶•)
                rotationVelocity.y += deltaX * 0.005;
                
                // ìƒí•˜ íšŒì „ (Xì¶•) - ê°ë„ ë‚®ì¶¤
                rotationVelocity.x += deltaY * 0.002;
                
                previousMousePosition = { 
                    x: e.touches[0].clientX, 
                    y: e.touches[0].clientY 
                };

            } else if (e.touches.length === 2) {
                // ë‘ ì†ê°€ë½: í•€ì¹˜ ì¤Œ
                const currentDistance = getTouchDistance(e.touches);
                const scale = touchStartDistance / currentDistance;
                
                camera.position.z = Math.max(40, Math.min(180, initialCameraZ * scale));
            }
        }

        function onTouchEnd(e) {
            isDragging = false;
            if (e.touches.length === 0) {
                touchStartDistance = 0;
            }
        }

        function getTouchDistance(touches) {
            const dx = touches[0].clientX - touches[1].clientX;
            const dy = touches[0].clientY - touches[1].clientY;
            return Math.sqrt(dx * dx + dy * dy);
        }

        // ì¤Œ ë²„íŠ¼ í•¨ìˆ˜ (ëª¨ë°”ì¼ìš©)
        window.zoomIn = function() {
            camera.position.z = Math.max(40, camera.position.z - 10);
        };

        window.zoomOut = function() {
            camera.position.z = Math.min(180, camera.position.z + 10);
        };

        function onKeyDown(e) {
            switch(e.key.toLowerCase()) {
                case 't': window.toggleTreeMode(); break;
                case 's': window.toggleSnow(); break;
                case 'f': window.launchFireworks(); break;
                case 'r': window.toggleAutoRotate(); break;
                case 'b': window.showBlessings(); break;
            }
        }

        // --- ì• ë‹ˆë©”ì´ì…˜ ë£¨í”„ ---
        function animate() {
            requestAnimationFrame(animate);
            time += 0.01;

            // ë©”ì‹œ ì—…ë°ì´íŠ¸
            updateMeshLogic(goldMesh, logicData.gold);
            updateMeshLogic(silverMesh, logicData.silver);
            updateMeshLogic(gemMesh, logicData.gem);
            updateMeshLogic(emeraldMesh, logicData.emerald);

            // ë¨¼ì§€ ì—…ë°ì´íŠ¸
            updateDustLogic();

            // ë³„ ì—…ë°ì´íŠ¸
            if (logicData.star) {
                const target = currentState === STATE.TREE 
                    ? logicData.star.userData.treePos 
                    : logicData.star.userData.scatterPos;
                logicData.star.position.lerp(target, 0.05);
                logicData.star.rotation.y += 0.02;
                logicData.star.rotation.x = Math.sin(time) * 0.2;
            }

            // íšŒì „ ì²˜ë¦¬
            handleRotation();

            composer.render();
        }

        function handleRotation() {
            if (autoRotate && !isDragging) {
                if (currentState === STATE.TREE) {
                    mainGroup.rotation.y += 0.003;
                } else {
                    mainGroup.rotation.y += 0.001;
                }
            }
            
            // ê´€ì„± ì ìš© (360ë„ ììœ  íšŒì „)
            mainGroup.rotation.y += rotationVelocity.y;
            mainGroup.rotation.x += rotationVelocity.x;
            
            // ê°ì‡ 
            rotationVelocity.y *= 0.92;
            rotationVelocity.x *= 0.92;
            
            // Xì¶• ì œí•œ í™•ì¥ (ë” ë„“ì€ ë²”ìœ„ë¡œ íšŒì „ ê°€ëŠ¥)
            mainGroup.rotation.x = Math.max(-1.2, Math.min(1.2, mainGroup.rotation.x));
        }

        function updateMeshLogic(mesh, dataArray) {
            const isTree = currentState === STATE.TREE;

            for (let i = 0; i < dataArray.length; i++) {
                const item = dataArray[i];
                const target = isTree ? item.treePos : item.scatterPos;

                // ì‚°ê°œ ìƒíƒœì—ì„œ í˜¸í¡ íš¨ê³¼
                if (!isTree) {
                    item.currentPos.y += Math.sin(time + i * 0.1) * 0.015;
                }

                // ìœ„ì¹˜ ë³´ê°„
                item.currentPos.lerp(target, 0.06);

                // ìì²´ íšŒì „
                item.rotation.x += item.rotSpeed.x;
                item.rotation.y += item.rotSpeed.y;

                dummy.position.copy(item.currentPos);
                dummy.rotation.copy(item.rotation);
                dummy.scale.setScalar(item.scale);
                dummy.updateMatrix();
                mesh.setMatrixAt(i, dummy.matrix);
            }
            mesh.instanceMatrix.needsUpdate = true;
        }

        function updateDustLogic() {
            const positions = dustSystem.geometry.attributes.position.array;
            const isTree = currentState === STATE.TREE;

            for (let i = 0; i < logicData.dust.length; i++) {
                const item = logicData.dust[i];

                if (isTree) {
                    // íŠ¸ë¦¬ ìƒíƒœ: ìœ„ë¡œ ìƒìŠ¹
                    item.currentPos.y += item.velocity;
                    if (item.currentPos.y > CONFIG.treeHeight / 2) {
                        item.currentPos.y = -CONFIG.treeHeight / 2;
                    }

                    // ì›ë¿” ë²”ìœ„ ì œí•œ
                    const rMax = CONFIG.maxRadius * 
                        (1 - (item.currentPos.y + CONFIG.treeHeight / 2) / CONFIG.treeHeight) + 5;
                    const rCurr = Math.sqrt(
                        item.currentPos.x ** 2 + item.currentPos.z ** 2
                    );
                    if (rCurr > rMax) {
                        item.currentPos.x *= 0.95;
                        item.currentPos.z *= 0.95;
                    }
                } else {
                    // ì‚°ê°œ ìƒíƒœ
                    item.currentPos.lerp(item.scatterPos, 0.03);
                }

                positions[i * 3] = item.currentPos.x;
                positions[i * 3 + 1] = item.currentPos.y;
                positions[i * 3 + 2] = item.currentPos.z;
            }
            dustSystem.geometry.attributes.position.needsUpdate = true;
        }

        // --- ì „ì—­ í•¨ìˆ˜ (UI ë²„íŠ¼ìš©) ---
        window.toggleTreeMode = function() {
            currentState = currentState === STATE.TREE ? STATE.SCATTER : STATE.TREE;
        };

        window.toggleAutoRotate = function() {
            autoRotate = !autoRotate;
        };

        window.resetCamera = function() {
            camera.position.set(0, 5, 180);  // ìµœëŒ€ ì¶•ì†Œ ìƒíƒœë¡œ ë¦¬ì…‹
            mainGroup.rotation.set(0, 0, 0);
            rotationVelocity = { x: 0, y: 0 };
        };

        // --- ëˆˆ íš¨ê³¼ ---
        const snowflakesContainer = document.getElementById('snowflakes');
        const snowflakeChars = ['â„', 'â…', 'â†', 'âœ»', 'âœ¼', 'â‰'];
        let snowEnabled = true;

        function createSnowflake() {
            if (!snowEnabled) return;
            
            const snowflake = document.createElement('div');
            snowflake.className = 'snowflake';
            snowflake.textContent = snowflakeChars[Math.floor(Math.random() * snowflakeChars.length)];
            snowflake.style.left = Math.random() * 100 + 'vw';
            snowflake.style.fontSize = (Math.random() * 1.5 + 0.5) + 'rem';
            snowflake.style.animationDuration = (Math.random() * 5 + 5) + 's';
            snowflakesContainer.appendChild(snowflake);
            setTimeout(() => snowflake.remove(), 12000);
        }

        setInterval(createSnowflake, 250);

        window.toggleSnow = function() {
            snowEnabled = !snowEnabled;
            if (!snowEnabled) snowflakesContainer.innerHTML = '';
        };

        // --- ë¶ˆê½ƒë†€ì´ ---
        window.launchFireworks = function() {
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    createFirework(
                        Math.random() * window.innerWidth,
                        Math.random() * window.innerHeight * 0.5 + 50
                    );
                }, i * 300);
            }
        };

        function createFirework(x, y) {
            const colors = ['#ff0000', '#ffd700', '#00ff00', '#00ffff', '#ff00ff', '#ff6b6b'];
            const color = colors[Math.floor(Math.random() * colors.length)];
            
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'firework-particle';
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                particle.style.backgroundColor = color;
                particle.style.boxShadow = `0 0 6px ${color}`;
                
                const angle = (i / 30) * Math.PI * 2;
                const velocity = 50 + Math.random() * 100;
                particle.style.setProperty('--tx', Math.cos(angle) * velocity + 'px');
                particle.style.setProperty('--ty', Math.sin(angle) * velocity + 'px');
                
                document.body.appendChild(particle);
                setTimeout(() => particle.remove(), 1500);
            }
        }

        // --- ë•ë‹´ ---
        const blessings = [
            { emoji: 'ğŸŒŸ', text: '2025ë…„ ìƒˆí•´ì—ëŠ” ë‹¹ì‹ ì˜ ëª¨ë“  ê¿ˆê³¼ í¬ë§ì´ ì´ë£¨ì–´ì§€ê¸¸ ë°”ëë‹ˆë‹¤.<br>ë§¤ì¼ ì•„ì¹¨ ëˆˆì„ ëœ° ë•Œë§ˆë‹¤ ê°ì‚¬í•¨ê³¼ í–‰ë³µì´ ê°€ë“í•˜ì‹œê¸¸!' },
            { emoji: 'ğŸ’', text: 'ì‚¬ë‘í•˜ëŠ” ì‚¬ëŒë“¤ê³¼ í•¨ê»˜í•˜ëŠ” ë”°ëœ»í•œ ìˆœê°„ë“¤ì´ ëŠ˜ í•¨ê»˜í•˜ì‹œê³ ,<br>ì›ƒìŒì´ ëŠì´ì§€ ì•ŠëŠ” í•œ í•´ê°€ ë˜ì‹œê¸¸ ì§„ì‹¬ìœ¼ë¡œ ê¸°ì›í•©ë‹ˆë‹¤.' },
            { emoji: 'ğŸ€', text: 'ê±´ê°•ì€ ëª¨ë“  í–‰ë³µì˜ ê¸°ì´ˆì…ë‹ˆë‹¤. 2025ë…„ì—ëŠ” ëª¸ë„ ë§ˆìŒë„ ê±´ê°•í•˜ê²Œ,<br>í•˜ë£¨í•˜ë£¨ê°€ í™œë ¥ ë„˜ì¹˜ëŠ” ë‚ ë“¤ì´ ë˜ì‹œê¸¸ ë°”ëë‹ˆë‹¤!' },
            { emoji: 'âœ¨', text: 'ë„ì „ì„ ë‘ë ¤ì›Œí•˜ì§€ ë§ˆì„¸ìš”. ìƒˆí•´ì—ëŠ” ìƒˆë¡œìš´ ì‹œì‘ì´ ê°€ì ¸ë‹¤ì¤„<br>ë¬´í•œí•œ ê°€ëŠ¥ì„±ì„ ë¯¿ê³ , ìš©ê¸° ìˆê²Œ í•œ ê±¸ìŒ ë‚´ë”›ìœ¼ì‹œê¸¸!' },
            { emoji: 'ğŸ', text: '2025ë…„, ë‹¹ì‹ ì—ê²Œ ì°¾ì•„ì˜¬ ëª¨ë“  ìˆœê°„ë“¤ì´ ì„ ë¬¼ì²˜ëŸ¼ ì†Œì¤‘í•˜ê³ ,<br>í¬ë¦¬ìŠ¤ë§ˆìŠ¤ì˜ ë”°ëœ»í•¨ì´ 365ì¼ ë‚´ë‚´ í•¨ê»˜í•˜ì‹œê¸¸ ë°”ëë‹ˆë‹¤!' }
        ];
        let currentBlessing = 0;

        window.showBlessings = function() {
            document.getElementById('blessingsPanel').classList.add('show');
            updateBlessingText();
        };

        window.closeBlessings = function() {
            document.getElementById('blessingsPanel').classList.remove('show');
        };

        function updateBlessingText() {
            const b = blessings[currentBlessing];
            document.getElementById('blessingText').innerHTML = `${b.emoji} ${b.text}`;
        }

        window.nextBlessing = function() {
            currentBlessing = (currentBlessing + 1) % blessings.length;
            updateBlessingText();
        };

        window.prevBlessing = function() {
            currentBlessing = (currentBlessing - 1 + blessings.length) % blessings.length;
            updateBlessingText();
        };

        // --- ë§ˆìš°ìŠ¤ íŠ¸ë ˆì¼ (PCë§Œ) ---
        let trailCount = 0;
        const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
        
        if (!isTouchDevice) {
            document.addEventListener('mousemove', (e) => {
                trailCount++;
                if (trailCount % 6 !== 0) return;
                
                const trail = document.createElement('div');
                trail.className = 'mouse-trail';
                trail.textContent = ['âœ¨', 'â­', 'â„'][Math.floor(Math.random() * 3)];
                trail.style.left = e.clientX + 'px';
                trail.style.top = e.clientY + 'px';
                document.body.appendChild(trail);
                setTimeout(() => trail.remove(), 1000);
            });
        }

        // --- ëª¨ë°”ì¼ ì„±ëŠ¥ ìµœì í™” ---
        function isMobile() {
            return window.innerWidth <= 768 || isTouchDevice;
        }

        // ëª¨ë°”ì¼ì—ì„œ íŒŒí‹°í´ ìˆ˜ ì¤„ì´ê¸°
        if (isMobile()) {
            // ëˆˆ ìƒì„± ê°„ê²© ëŠ˜ë¦¬ê¸°
            clearInterval(window.snowInterval);
        }

        // í™”ë©´ ë°©í–¥ ë³€ê²½ ê°ì§€
        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                onWindowResize();
            }, 100);
        });

        // í™”ë©´ ì‚¬ì´ì¦ˆ ë³€ê²½ ì‹œ ëª¨ë°”ì¼ UI ì—…ë°ì´íŠ¸
        window.addEventListener('resize', () => {
            const zoomControls = document.getElementById('zoomControls');
            const mobileHint = document.getElementById('mobileHint');
            
            if (window.innerWidth <= 768) {
                if (zoomControls) zoomControls.style.display = 'flex';
            } else {
                if (zoomControls) zoomControls.style.display = 'none';
                if (mobileHint) mobileHint.style.display = 'none';
            }
        });

        // --- ì‹œì‘ ---
        init();

        // ì´ˆê¸° ë¶ˆê½ƒë†€ì´
        setTimeout(() => window.launchFireworks(), 2000);

        console.log(`
        ğŸ„ Merry Christmas 2025! ğŸ„
        â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
        
        âœ¨ Created by Tsun Kim âœ¨
        ê¹€ê²½í•œ (KIM GYEONG HAN)
        
        â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
        ğŸ Happy New Year! ğŸ
        `);
    </script>
</body>
</html>
